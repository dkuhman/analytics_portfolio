---
title: "Code Documentation for Case Study: A Sales Report for Global Superstore"
author: "Analysis performed by: Daniel Kuhman"
date: "Date: `r Sys.Date()`"
output: html_document
---

## Code Description

This is the code used to generate the sales report associated with Case Study: A Sales Report for Global Superstore. 

You can find the report

## Tools Used

## Skills Demonstrated

---

### Load libraries 
```{r include=TRUE, results='hide', message=FALSE, warning=FALSE}
library(tidyverse)
```

### Clear workspace and load data
```{r}
rm(list = ls())
wd = getwd()
all_data <- read.csv(paste0(wd,'/data/global_superstore_2016_orders.csv'))
```

### Glimpse of data to understand structure
```{r}
str(all_data)
```

### Tidy data
For clarity, I renamed columns into a CamelCase format and limited the data set to only fields needed for this analysis. 
```{r}
all_data <- all_data %>% 
  rename(OrderId = Order.ID,
         RowId = Row.ID,
         OrderDate = Order.Date,
         ShipDate = Ship.Date,
         ShipMode = Ship.Mode,
         CustomerId = Customer.ID,
         CustomerName = Customer.Name,
         PostalCode = Postal.Code,
         ProductId = Product.ID,
         SubCategory = Sub.Category,
         ProductName = Product.Name,
         ShippingCost = Shipping.Cost,
         OrderPriority = Order.Priority) %>% 
  select(OrderId, Region, OrderDate, CustomerId, Segment,
         Market, ProductId, Category, SubCategory, ProductName, 
         Sales, Quantity, Profit)
```

I need to add fields for the year of each order to analyze sales across time, per their request:
```{r}
# Format as dates
all_data$OrderDate <- as.Date(all_data$OrderDate, '%m/%d/%Y')

# Get order year
all_data$OrderYear <- format(all_data$OrderDate, '%Y')
```

Convert dollar amounts to numeric values:
```{r}
all_data$Sales = gsub("\\$", "", all_data$Sales)
all_data$Sales = gsub("\\,", "", all_data$Sales)
all_data$Sales = as.numeric(all_data$Sales)

all_data$Profit = gsub("\\$", "", all_data$Profit)
all_data$Profit = gsub("\\,", "", all_data$Profit)
all_data$Profit = as.numeric(all_data$Profit)
```

---

# Yearly Sales Performance

To find new customers per year, I will group by ```CustomerID``` and find their first order - the ```OrderYear``` associated with that order will be considered their year of becoming a new customer. I will then group by ```OrderYear``` and count the number of customers:

```{r}
new_customers <- all_data %>% 
  group_by(CustomerId) %>% 
  summarise(FirstOrder = min(OrderDate)) %>% 
  ungroup() %>% 
  mutate(cohort = format(FirstOrder, '%Y')) %>% 
  group_by(cohort) %>% 
  summarise(NewUsers = n()) %>% 
  ungroup()

new_customers
```

For yearly sales performance, I will group by ```OrderYear``` and summarize sales data:
```{r}
yearly_sales <- all_data %>% 
  group_by(OrderYear) %>% 
  summarise(OrdersFilled = n(), 
            ItemsSold = sum(Quantity),
            VolumeSold = sum(Sales))

yearly_sales
```

### New customers by year:
```{r}
ggplot(new_customers, aes(x = cohort, 
                           y = NewUsers)) +
    geom_bar(stat = 'identity',
             color = 'black',
             fill = '#3366CC') +
    geom_text(aes(label = NewUsers), 
              nudge_y = 200) +
    labs(title = 'New Customers by Year',
         x = '',
         y = 'New Customers') +
    theme_bw() +
    theme(plot.title = element_text(size = 18, face = 'bold', hjust = 0.5),
          axis.title.y = element_text(size = 16, face = 'bold', margin = margin(t = 0, r = 15, b = 0, l = 0)),
          axis.text = element_text(size = 12, color = 'black'))
```


### Number of orders placed by year:
```{r}
ggplot(yearly_sales, aes(x = OrderYear, 
                           y = OrdersFilled)) +
    geom_bar(stat = 'identity',
             color = 'black',
             fill = '#3366CC') +
    geom_text(aes(label = OrdersFilled), 
              nudge_y = 1000) +
    labs(title = 'Total Order Count by Year',
         x = '',
         y = 'Orders Placed') +
    theme_bw() +
    theme(plot.title = element_text(size = 18, face = 'bold', hjust = 0.5),
          axis.title.y = element_text(size = 16, face = 'bold', margin = margin(t = 0, r = 15, b = 0, l = 0)),
          axis.text = element_text(size = 12, color = 'black'))
```

### Number of items sold by year:
```{r}
ggplot(yearly_sales, aes(x = OrderYear, 
                           y = ItemsSold)) +
    geom_bar(stat = 'identity',
             color = 'black',
             fill = '#3366CC') +
    geom_text(aes(label = ItemsSold), 
              nudge_y = 2000) +
    labs(title = 'Total Items Sold by Year',
         x = '',
         y = 'Items Sold') +
    theme_bw() +
    theme(plot.title = element_text(size = 18, face = 'bold', hjust = 0.5),
          axis.title.y = element_text(size = 16, face = 'bold', margin = margin(t = 0, r = 15, b = 0, l = 0)),
          axis.text = element_text(size = 12, color = 'black'))
```

### Total sales revenue ($) by year:
```{r}
options(scipen = 10)
ggplot(yearly_sales, aes(x = OrderYear, 
                           y = VolumeSold)) +
    geom_bar(stat = 'identity',
             color = 'black',
             fill = '#3366CC') +
    geom_text(aes(label = paste0('$', VolumeSold)), 
              nudge_y = 100000) +
    labs(title = 'Total Revenue ($) from Sales by Year',
         x = '',
         y = 'Sales Revenue ($)') +
    theme_bw() +
    theme(plot.title = element_text(size = 18, face = 'bold', hjust = 0.5),
          axis.title.y = element_text(size = 16, face = 'bold', margin = margin(t = 0, r = 15, b = 0, l = 0)),
          axis.text.x = element_text(size = 12, color = 'black'),
          axis.text.y = element_text(size = 12, color = 'black', angle = 30))
```

---

# Sales Performance by Region
To get a better idea of how well each region has performed over time, I will group by ```Region``` and ```OrderYear``` and calculate performance metrics:

```{r message=FALSE}
regional_data <- all_data %>% 
  group_by(Region, OrderYear) %>% 
  summarise(OrdersFilled = n(), 
            ItemsSold = sum(Quantity),
            VolumeSold = sum(Sales)) %>% 
  ungroup()

head(regional_data, 10)

```

--- 

# Most Profitable Products

